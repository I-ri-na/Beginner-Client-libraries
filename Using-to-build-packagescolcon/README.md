# Использование для сборки пакетов colcon
Цель: Создание рабочей области ROS 2 с помощью .colcon
colcon является итерацией инструментов сборки ROS

# Необходимые условия
## Установка colcon
```sudo apt install python3-colcon-common-extensions```

## Установка ROS 2
# Основные
Рабочая область ROS — это директория с определенной структурой. Обычно есть поддиректория. Внутри этого подкаталога находится исходный код пакетов ROS. Как правило, каталог начинается с пустого места.src

Colcon выполняет сборки из исходного кода. По умолчанию он создаст следующие директории в качестве одноранговых узлов каталога:src

В директории будут храниться промежуточные файлы. Для каждого пакета будет создана подпапка, в которой, например, будет вызываться CMake.build

Каталог — это место, куда будет установлен каждый пакет. По умолчанию каждый пакет будет установлен в отдельный подкаталог.install

Каталог содержит различную информацию о каждом вызове colcon.log

##Создание рабочего пространства
Сначала создадим каталог (), в котором будет содержаться наша рабочая область:ros2_ws
```mkdir -p ~/ros2_ws/src```
```cd ~/ros2_ws```
На этом этапе рабочая область содержит одну пустую директорию:src


![image](https://i.postimg.cc/fyLTMRVH/2024-11-26-085504.png)


# Добавьте несколько источников
Давайте клонируем репозиторий примеров в директорию рабочей области:src

```git clone https://github.com/ros2/examples src/examples -b rolling```
Теперь в рабочей области должен быть исходный код для примеров ROS 2:
![image](https://i.postimg.cc/VNkYqNRz/2024-11-26-090708.png)
# Источник подложки
Важно, чтобы мы нашли среду для существующей установки ROS 2, которая предоставит нашему рабочему пространству необходимые зависимости сборки для примеров пакетов. Это достигается путем использования установочного скрипта, предоставляемого двоичной установкой или исходной установкой, т.е. еще одно рабочее пространство colcon (см. раздел Установка). Мы называем эту среду подложкой.

Наше рабочее пространство будет наложено поверх существующей установки ROS 2. Как правило, рекомендуется использовать оверлей, когда вы планируете выполнять итерации по небольшому количеству пакетов, а не размещать все пакеты в одном рабочем пространстве.ros2_ws
# Создание рабочего пространства
В корневом каталоге рабочей области выполните . Поскольку такие типы сборки, как не поддерживают концепцию пространства и требуют установки пакета, colcon поддерживает опцию . Это позволяет изменять установленные файлы, изменяя файлы в пространстве (например, файлы Python или другие нескомпилированные ресурсы) для более быстрой итерации.colcon buildament_cmakedevel--symlink-installsource
```colcon build --symlink-install```
После того, как сборка будет завершена, мы должны увидеть каталоги , и следующие:build install log
![image](https://github.com/I-ri-na/Using-to-build-packagescolcon/blob/main/image/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202024-11-26%20092548.png)
# Выполнение тестов
Чтобы запустить тесты для только что собранных пакетов, выполните следующее:
```colcon test```
# Источник среды
Когда colcon успешно завершит сборку, вывод будет в каталоге. Прежде чем вы сможете использовать какой-либо из установленных исполняемых файлов или библиотек, вам потребуется добавить их в путь и пути к библиотеке. colcon сгенерирует файлы bash/bat в каталоге, чтобы помочь настроить среду. Эти файлы добавят все необходимые элементы в путь и пути к библиотеке, а также предоставят любые команды bash или shell, экспортируемые пакетами.install install
```source install/setup.bash```
# Попробовать демоверсию
Имея исходное окружение, мы можем запускать исполняемые файлы, собранные с помощью colcon. Запустим узел-подписчик из примеров:
```ros2 run examples_rclcpp_minimal_subscriber subscriber_member_function```
В другом терминале запустим узел издателя (не забудьте указать исходный код скрипта настройки):
```ros2 run examples_rclcpp_minimal_publisher publisher_member_function```
Вы должны увидеть сообщения от издателя и подписчика с увеличивающимися цифрами.
# Создайте свой собственный пакет
colcon использует спецификацию, определенную в REP 149 (также поддерживается формат 2).package.xml

Colcon поддерживает несколько типов сборки. Рекомендуемыми типами сборки являются и . Также поддерживаются чистые пакеты.ament_cmakeament_pythoncmake

Примером сборки является пакет ament_index_python , где setup.py является основной точкой входа для сборки.ament_python

Пакет, такой как demo_nodes_cpp, использует тип сборки и CMake в качестве средства сборки.ament_cmake

Для удобства вы можете использовать инструмент для создания нового пакета на основе шаблона.ros2 pkg create

# Настройка
Команда позволяет быстро изменить текущий рабочий каталог вашей оболочки на каталог пакета. В качестве примера вы быстро попадете в каталог .colcon_cdcolcon_cd some_ros_package~/ros2_ws/src/some_ros_package
```echo "source /usr/share/colcon_cd/function/colcon_cd.sh" >> ~/.bashrc```
```echo "export _colcon_cd_root=/opt/ros/rolling/" >> ~/.bashrc```
В зависимости от способа установки и расположения вашего рабочего пространства, приведенные выше инструкции могут отличаться, обратитесь к документации для получения более подробной информации. Чтобы отменить эту ошибку в Linux и macOS, найдите сценарий запуска оболочки вашей системы и удалите добавленные команды source и export.colcon_cd

# Завершение вкладки «Настройка
Команда поддерживает завершение команд для bash и bash-подобных оболочек. Пакет должен быть установлен, и для его работы может потребоваться некоторая настройка.colconcolcon-argcomplete

# Советы
Если вы не хотите собирать определенный пакет, поместите пустой файл с именем в директорию, и он не будет индексироваться.COLCON_IGNORE

Если вы хотите избежать настройки и сборки тестов в пакетах CMake, вы можете передать: .--cmake-args -DBUILD_TESTING=0

Если вы хотите запустить один конкретный тест из пакета:
```colcon test --packages-select YOUR_PKG_NAME --ctest-args -R YOUR_TEST_IN_PKG```


